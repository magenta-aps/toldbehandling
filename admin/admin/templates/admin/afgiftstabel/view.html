{% extends "admin/admin_layout.html" %}
{% load static %}
{% load i18n %}
{% load l10n %}
{% load admin_tags %}
{% load common_tags %}

{# Docs for bootstrap-table: https://bootstrap-table.com/docs/ #}
{% block extra_headers %}
<link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css">
<link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/extensions/sticky-header/bootstrap-table-sticky-header.min.css">
{% endblock %}
{% block extra_footers %}
<script src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script>
<script src="https://unpkg.com/bootstrap-table@1.22.1/dist/extensions/sticky-header/bootstrap-table-sticky-header.min.js"></script>
{% endblock %}

{% block content %}
<div class="mx-5">
    <h1>Afgiftstabel</h1>
    <form method="post" action="">
        {% csrf_token %}
        <div class="row">
            <div class="col-6">
                <div class="row">
                    <div class="col-2"><label for="{{form.gyldig_fra.name}}">{% translate "Gyldig fra" %}</label></div>
                    <div class="col-10">
                        {% if can_edit %}
                        {{form.gyldig_fra}}
                        {{form.gyldig_fra.errors}}
                        {% else %}
                        {{object.gyldig_fra|default_if_none:"-"}}
                        {% endif %}
                    </div>
                </div>
                <div class="row">
                    <div class="col-2"><label>{% translate "Gyldig til" %}</label></div>
                    <div class="col-10">{{object.gyldig_til|default_if_none:"-"}}</div>
                </div>
                <div class="row">
                    <div class="col-2"><label for="{{form.kladde.name}}">{% translate "Kladde" %}</label></div>
                    <div class="col-10">
                        {% if can_edit %}
                            {{form.kladde}}
                            {{form.kladde.errors}}
                        {% endif %}
                        {% if not object.kladde %}
                            {% translate "Nej" %}
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="col-6 clearfix">
                <a href="#" class="btn btn-primary float-end">Download</a>
                {% if can_edit %}
                <button type="submit" class="btn btn-success float-end">Opdatér</button>
                {% endif %}
            </div>
        </div>
    </form>
    <div class="card">
        <div class="card-body">
            <ul class="mb-0">
                <li>
                    {% blocktranslate %}
                    Der kan kun ændres tabeller som er kladder eller som begynder i fremtiden
                    {% endblocktranslate %}
                </li>
                <li>
                    {% blocktranslate %}
                    En aktiv afgiftstabel er gældende fra dens begyndelsestidspunkt
                    frem til begyndelsen på den næste aktive afgiftstabel
                    {% endblocktranslate %}
                </li>
            </ul>
        </div>
    </div>

    <table class="table"
           data-toggle="table"
           data-sticky-header="true"
           data-classes="table"
    >
        <thead>
        <tr>
            <th class="col-1">{% translate "Afgifts­gruppe­nummer" %}</th>
            <th class="col-5">{% translate "Vareart" %}</th>
            <th class="col-1">{% translate "Enhed" %}</th>
            <th class="col-1">{% translate "Kræver indførsels­tilladelse" %}</th>
            <th class="col-1">{% translate "Minimumsbeløb" %}</th>
            <th class="col-1">{% translate "Afgiftssats" %}</th>
            <th class="col-1">{% translate "Nedre mængde­grænse" %}</th>
            <th class="col-1">{% translate "Øvre mængde­grænse" %}</th>
        </tr>
        </thead>
        <tbody>
        {% for vareafgiftssats in object.vareafgiftssatser %}
        {% if not vareafgiftssats.overordnet %}
            <tr>
                {% if vareafgiftssats.subsatser %}
                    <td rowspan="{{vareafgiftssats.subsatser|length|add:1}}">
                        {% localize off %}{{vareafgiftssats.afgiftsgruppenummer}}{% endlocalize %}
                    </td>
                    <td>{{vareafgiftssats.vareart}}</td>
                    <td>{{vareafgiftssats.enhed|enhedsnavn}}</td>
                    <td>{{vareafgiftssats.kræver_indførselstilladelse|yesno}}</td>
                    <td colspan="4"></td>
                {% else %}
                    <td>
                        {% localize off %}{{vareafgiftssats.afgiftsgruppenummer}}{% endlocalize %}
                    </td>
                    <td>{{vareafgiftssats.vareart}}</td>
                    <td>{{vareafgiftssats.enhed|enhedsnavn}}</td>
                    <td></td>
                    <td>{{vareafgiftssats.minimumsbeløb|default_if_none:""}}</td>
                    <td>{{vareafgiftssats.afgiftssats}}</td>
                    <td>{{vareafgiftssats.segment_nedre|default_if_none:""}}</td>
                    <td>{{vareafgiftssats.segment_øvre|default_if_none:""}}</td>
                {% endif %}
            </tr>
            {% for subsats in vareafgiftssats.subsatser %}
            <tr>
                <td>{{subsats.vareart}}</td>
                <td>{{subsats.enhed|enhedsnavn}}</td>
                <td></td>
                <td>{{vareafgiftssats.minimumsbeløb|default_if_none:""}}</td>
                <td>{{subsats.afgiftssats}}</td>
                <td>{{subsats.segment_nedre|default_if_none:""}}</td>
                <td>{{subsats.segment_øvre|default_if_none:""}}</td>
            </tr>
            {% endfor %}
        {% endif %}
        {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
