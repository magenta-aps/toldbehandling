{% extends "admin/admin_layout.html" %}
{% load static %}
{% load i18n %}
{% load l10n %}

{% block extra_headers %}
<script type="text/javascript" src="{% static 'toldbehandling/js/formfile.js' %}" nonce="{{ request.csp_nonce }}"></script>
<link rel="stylesheet" type="text/css" href="{% static 'toldbehandling/css/formfile.css' %}"/>
{% endblock %}

{% block content %}
<div class="content">
    <form method="post" action="{% url 'afgiftstabel_create' %}" enctype="multipart/form-data">
        {% csrf_token %}
        <h1 class="mb-3">Opret afgiftstabel</h1>
        <div class="row">
            <div class="col-6">
                <label for="{{form.fil.name}}" class="mb-3">Regneark:</label>
                {{form.fil}}
                {{form.fil.errors}}
            </div>
        </div>
        <div class="row mt-3">
            <div class="col-6">
                <button type="submit" class="btn btn-primary">
                    <span class="material-icons">check</span>
                    <span>{% translate "Opret" %}</span>
                </button>
            </div>
        </div>
    </form>
</div>

<script nonce="{{ request.csp_nonce }}">
    $(function () {
        // Filefield
        // ---------
        const fileUpdate = function () {
            // Vis filnavn
            $(this).parents(".custom-file").find(".custom-file-label").text(
                $(this).val().split("\\").pop()
            );
            // Validér filstørrelse
            if (this.files.length) {
                const maxsize = this.getAttribute("max_size");
                const filesize = this.files[0].size;
                if (maxsize && filesize > maxsize) {
                    this.setCustomValidity(this.getAttribute("data-validity-sizeoverflow"));
                } else {
                    this.setCustomValidity("");
                }
            }
        };
        const fileInputs = $("input[type=file]");
        fileInputs.change(fileUpdate);
        fileInputs.each(fileUpdate);
    });
</script>
{% endblock %}
