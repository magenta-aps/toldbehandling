{% extends "told_common/card.html" %}
{% load i18n %}

{% block extra_media %}
{{ form.media }}
{% endblock %}


{% block card_title %}{% translate "Aktiv√©r Tofaktor-autentifikation" %}{% endblock %}

{% block card_content %}

{% if wizard.steps.current == 'welcome' %}
<p>
    {% blocktranslate trimmed %}
    You are about to take your account security to the
    next level. Follow the steps in this wizard to enable two-factor
    authentication.
    {% endblocktranslate %}
</p>

{% elif wizard.steps.current == 'method' %}
<p>
    {% blocktranslate trimmed %}
    Please select which authentication method you would like to use.
    {% endblocktranslate %}
</p>

{% elif wizard.steps.current == 'generator' %}
<p>
    {% blocktranslate trimmed %}
    To start using a token generator, please use your
    smartphone to scan the QR code below. For example, use Google
    Authenticator.
    {% endblocktranslate %}
</p>
<p>
    <img src="{{ QR_URL }}" alt="QR Code" class="bg-white"/>
</p>
<p>
    {% blocktranslate trimmed %}
    Alternatively you can use the following secret to
    setup TOTP in your authenticator or password manager manually.
    {% endblocktranslate %}
</p>
<p>
    {% translate "TOTP Secret:" %} <a href="{{ otpauth_url }}">{{ secret_key }}</a>
</p>
<p>
    {% blocktranslate trimmed %}
    Then, enter the token generated by the app.
    {% endblocktranslate %}
</p>

{% elif wizard.steps.current == 'sms' %}
<p>
    {% blocktranslate trimmed %}
    Please enter the phone number you wish to receive the
    text messages on. This number will be validated in the next step.
    {% endblocktranslate %}
</p>

{% elif wizard.steps.current == 'call' %}
<p>
    {% blocktranslate trimmed %}
    Please enter the phone number you wish to be called on.
    This number will be validated in the next step.
    {% endblocktranslate %}
</p>

{% elif wizard.steps.current == 'validation' %}
    {% if challenge_succeeded %}
        {% if device.method == 'call' %}
        <p>
            {% blocktranslate trimmed %}
            We are calling your phone right now, please enter the digits you hear.
            {% endblocktranslate %}
        </p>

        {% elif device.method == 'sms' %}
        <p>
            {% blocktranslate trimmed %}
            We sent you a text message, please enter the tokens we sent.
            {% endblocktranslate %}
        </p>
        {% endif %}
    {% else %}
        <p class="alert alert-warning" role="alert">
            {% blocktranslate trimmed %}
            We've encountered an issue with the selected authentication method. Please
            go back and verify that you entered your information correctly, try
            again, or use a different authentication method instead. If the issue
            persists, contact the site administrator.
            {% endblocktranslate %}
        </p>
    {% endif %}

{% elif wizard.steps.current == 'yubikey' %}
    <p>
        {% blocktranslate trimmed %}
        To identify and verify your YubiKey, please insert a
        token in the field below. Your YubiKey will be linked to your
        account.
        {% endblocktranslate %}
    </p>
{% endif %}

<form action="" method="post">{% csrf_token %}
    {% include "two_factor/_wizard_forms.html" %}

    {# hidden submit button to enable [enter] key #}
    <input type="submit" value="" hidden />

    {% include "two_factor/_wizard_actions.html" %}
</form>
{% endblock %}
